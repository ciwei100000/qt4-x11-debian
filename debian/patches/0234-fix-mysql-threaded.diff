qt-bugs@ issue : N217716
Trolltech task ID : 217788
bugs.kde.org number : no report
applied: no
author: Tobias Koenig <tokoe@kde.org>

This patch will fix the handling of connections to
mysql server in a multithreaded environment

--- a/src/sql/drivers/mysql/qsql_mysql.cpp
+++ b/src/sql/drivers/mysql/qsql_mysql.cpp
@@ -1257,6 +1257,10 @@ bool QMYSQLDriver::open(const QString& d
     d->preparedQuerysEnabled = false;
 #endif
 
+#ifndef QT_NO_THREAD
+    mysql_thread_init();
+#endif
+
     setOpen(true);
     setOpenError(false);
     return true;
@@ -1265,6 +1269,9 @@ bool QMYSQLDriver::open(const QString& d
 void QMYSQLDriver::close()
 {
     if (isOpen()) {
+#ifndef QT_NO_THREAD
+        mysql_thread_end();
+#endif
         mysql_close(d->mysql);
         d->mysql = NULL;
         setOpen(false);

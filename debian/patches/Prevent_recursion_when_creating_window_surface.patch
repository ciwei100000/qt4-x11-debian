commit 5ad8cd48a1ed3be183c0af8698491b039f0054e4
Author: Samuel RÃ¸dal <samuel.rodal@nokia.com>
Date:   Tue Feb 1 17:59:54 2011 +0100

    Prevent recursion when creating window surface.
    
    If we can't access the qt_gl_share_widget() we should just create a
    raster window surface. This might happen when creating the share widget
    itself leads to creation of a window surface (which isn't really going
    to be used anyways).
    
    Reviewed-by: Michael Dominic K

--- a/src/plugins/graphicssystems/meego/qmeegographicssystem.cpp
+++ b/src/plugins/graphicssystems/meego/qmeegographicssystem.cpp
@@ -42,6 +42,7 @@
 #include <QDebug>
 #include <private/qpixmap_raster_p.h>
 #include <private/qwindowsurface_gl_p.h>
+#include <private/qwindowsurface_raster_p.h>
 #include <private/qegl_p.h>
 #include <private/qglextensions_p.h>
 #include <private/qgl_p.h>
@@ -75,7 +76,12 @@ QMeeGoGraphicsSystem::~QMeeGoGraphicsSys
 
 QWindowSurface* QMeeGoGraphicsSystem::createWindowSurface(QWidget *widget) const
 {
-    QGLShareContextScope ctx(qt_gl_share_widget()->context());
+    QGLWidget *shareWidget = qt_gl_share_widget();
+
+    if (!shareWidget)
+        return new QRasterWindowSurface(widget);
+
+    QGLShareContextScope ctx(shareWidget->context());
 
     QMeeGoGraphicsSystem::surfaceWasCreated = true;
     QWindowSurface *surface = new QGLWindowSurface(widget);

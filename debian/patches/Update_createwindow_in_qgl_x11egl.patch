From 0aef3363aca14b0ba6ac56f86cadeb4acdef729e Mon Sep 17 00:00:00 2001
From: JuanZhao <juan.j.zhao@intel.com>
Date: Tue, 12 Apr 2011 09:37:53 +0200
Subject: [PATCH] Update XCreateWindow in qgl_X11egl.cpp
MIME-Version: 1.0
Content-Type: text/plain; charset=utf-8
Content-Transfer-Encoding: 8bit

XCreateWindow should provide mask and colormap, or this may load XCreateWindow error in the server side.

Merge-request: 1183
Reviewed-by: Samuel RÃ¸dal <samuel.rodal@nokia.com>
---
 src/opengl/qgl_x11egl.cpp |   10 +++++++++-
 1 files changed, 9 insertions(+), 1 deletions(-)

--- a/src/opengl/qgl_x11egl.cpp
+++ b/src/opengl/qgl_x11egl.cpp
@@ -105,10 +105,18 @@ QGLTemporaryContext::QGLTemporaryContext
         return;
     }
 
+    XSetWindowAttributes attr;
+    unsigned long mask;
+    attr.background_pixel = 0;
+    attr.border_pixel = 0;
+    attr.colormap = XCreateColormap(X11->display, DefaultRootWindow(X11->display), vi->visual, AllocNone);
+    attr.event_mask = StructureNotifyMask | ExposureMask;
+    mask = CWBackPixel | CWBorderPixel | CWColormap | CWEventMask;
+
     d->window = XCreateWindow(X11->display, RootWindow(X11->display, screen),
                               0, 0, 1, 1, 0,
                               vi->depth, InputOutput, vi->visual,
-                              0, 0);
+                              mask, &attr);
 
     d->surface = eglCreateWindowSurface(d->display, config, (EGLNativeWindowType) d->window, NULL);
 
